<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/menu.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/custom.css">
    <script src="js/jquery.js"></script>
    <script src="js/AddCommentUI.js"></script>
    <script src="js/alerts.js"></script>
    <script type="text/javascript">
    
    var root_url = window.location.protocol+'//'+window.location.host;
    var revision = getJsonFromUrl()['rev'];
    if(revision == '') {
        alert("Table view is available per revision and not for entire list");
        window.open(root_url+'/alerts.html', "_self");
        }
$(function() {
    
    var req = new XMLHttpRequest();
    req.onload = function(e) {
        var raw_data = JSON.parse(req.response);
        var data = raw_data.alerts;
        var plats = [];
        var tests = [];
        var rowlist = [];
        var celllist= [];
        document.getElementById("jump").innerHTML="<h4><a href="+root_url+"/alerts.html?rev="+revision+"&showall=1&testIndex=0&platIndex=0>Toggle View</a></h4>";
        var table = document.getElementById("data");
        var row = table.insertRow(0);
        var cell = row.insertCell(0);
        cell.innerHTML=" ";
        for(var i=0;i<data.length;i++) {
            if(plats.indexOf(data[i]["platform"]) == -1) {
                plats.push(data[i]["platform"]);
                cell = row.insertCell(1);
                cell.innerHTML="<b>"+data[i]["platform"]+"</b>";
            }
            
            if(tests.indexOf(data[i]["test"]) == -1) {
                tests.push(data[i]["test"]);
                var row0 = table.insertRow(1);
                rowlist.push(row0);
                var cell0 = row0.insertCell(0);
                cell0.innerHTML ="<b>"+data[i]["test"]+"</b>";
            }
        }
        for(var y=0;y<tests.length;y++) {
            for(var x=0;x<plats.length;x++) {
                var cell00= rowlist[y].insertCell(1)
                celllist.push(cell00);
            }
        }
        for(var i=0;i<data.length;i++) {
            var cell1 = celllist[(tests.indexOf(data[i]["test"])*plats.length)+plats.indexOf(data[i]["platform"])];
            var percent = parseInt((data[i]["percent"].split("%"))[0]);
            var format="";
            if(percent<=-10)
                format = "<font color = red>"+data[i]["percent"]+"<font>";
            else if(percent<0 && percent>-10)
                format = "<font color = orange>"+data[i]["percent"]+"<font>";
            else if(percent>0 && percent<10)
                format = "<font color = lime>"+data[i]["percent"]+"<font>";
            else
                format = "<font color = green>"+data[i]["percent"]+"<font>";
            cell1.innerHTML = "<b>"+format+"<b>";          
        }
    }
    req.open('get', root_url+'/alertsbyrev?keyrevision='+revision, true);
    req.send();
});

function getJsonFromUrl() {
    var query = location.search.substr(1);
    var data = query.split("&");
    var result = {};
    for (var i=0; i<data.length; i++) {
        var item = data[i].split("=");
        result[item[0]] = item[1];
    }
    return result;
}
    </script>
</head>
<body>
<div align="center" >
        <h3>Tabulated Data : </h3>
        <table class="sortable" id="data" border=1>
            <tr>
            </tr>
        </table>
    </div>
    <div id = "jump" align = "center"></div>
</body>
</html>
